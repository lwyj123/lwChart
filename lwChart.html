<!DOCTYPE html>
<html>
<head>
    <title>lineCounter</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf8">
    <meta name="author" content="Liang Yuyi 2014141463106" />
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="./js/Chart.bundle.js"></script>
    <script type="text/javascript" src="./js/hammer.js"></script>
    <script type="text/javascript" src="./js/chartjs-plugin-zoom.js"></script>

    <style>
            h2 {
                border-top: solid cornflowerblue 1px;
                border-left: solid cornflowerblue 1px;
                width: 50px;
                height: 25px;
                margin: 0;
                float: left;
                text-align: center;
            }
            
            .tab-content {
                border: solid cornflowerblue 1px;
                width: 100%;
            }
            
            .tab-content div{
                display: none;
                width:75%;
            }
            
            .selected {
                background-color: cornflowerblue;
            }
            
            .tab-content .show{
                display: block;
            }
            canvas {
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                height: 100%;
            }
    </style>
</head>

<body>
    <input type="file" id="files" multiple="" onchange="handleFiles(this.files)"/>
    <div class="tab-head">
        <h2 class="selected">1</h2>
        <h2>2</h2>
        <h2>3</h2>
    </div>
    <div class="tab-content">
        <div class="show">
            <canvas id="myChart" ></canvas>
        </div>
        <div>
            <canvas id="myChart2"></canvas>
        </div>

        <div>
            <canvas id="myChart3"></canvas>    
        </div>
    </div>

</body>
<script type="text/javascript">
//如果只想读取部分数据的话，File对象还有webkitSlice()或mozSlice()方法，用于生成Blob对象。这个对象可以和File对象一样被FileReader读取。这2个方法接收3个参数：第1个参数是起始位置；第2个是结束位置，省略时则读到文件结尾；第3个是content type。例子可以参考《Reading local files in JavaScript》。
(function() {
    var lwChart = {
        blob: new Blob(),
        reader: new FileReader(),

        handleFiles: function(files) {
            var self = this;
            if (files.length) {
                var file = files[0];
                var reader = new FileReader();
                if (/text\/\w+/.test(file.type)) {
                    reader.onload = function() {
                        $('<pre>' + reader.result + '</pre>').appendTo('body');
                    }
                    reader.readAsBinaryString(file);
                }
            }
        },
        

        bindEvent: function() {
            var self = this;

        },
        init: function() {
            this.bindEvent();
        }
    }
    lwChart.init();
})();

function handleFiles(files) {
    if (files.length) {
        var file = files[0];
        var reader = new FileReader();
        var outputdata = new Array();
        reader.onload = function() {
            var data = this.result;
            var len = data.length;
            for(var i = 0; i < data.length; i = i + 2) {
                outputdata.unshift({
                    x: i/2,
                    y: binstrToDec(data.slice(i,i+2))        
                })
            }
        }
        reader.readAsBinaryString(file);
        showData(outputdata);
    }
}

//输入2位的binary string 输出对应十进制数
function binstrToDec(binstr) {
    if(binstr.length != 2) {
        alter('错误的binary string');
        return;
    }
    var hex = binstr.charCodeAt(0).toString(16) + binstr.charCodeAt(1).toString(16);
    return parseInt(hex, 16);

}

function tabFcuntion() {
    var tabs = document.getElementsByClassName('tab-head')[0].getElementsByTagName('h2');
    var contents = document.getElementsByClassName('tab-content')[0].getElementsByTagName('div');

    (function changeTab(tab) {
        for(var i = 0, len = tabs.length; i < len; i++) {
            tabs[i].onmouseover = showTab;
        }
    })();

    function showTab() {
        for(var i = 0, len = tabs.length; i < len; i++) {
            if(tabs[i] === this) {
                tabs[i].className = 'selected';
                contents[i].className = 'show';
            } else {
                tabs[i].className = '';
                contents[i].className = '';
            }
        }
    }
}

tabFcuntion();


function showData(ChartData) {
    var ctx = document.getElementById("myChart");
    var scatterChartData = {
        datasets: [{
            type: 'line',
            label: "My First dataset",
            data: ChartData
        }]
    };
    var myChart = Chart.Scatter(ctx, {
        data: scatterChartData,
        options: {
            title: {
                display: true,
                text: 'Chart.js Scatter Chart'
            },
            pan: {
                enabled: true,
                mode: 'x'
            },
            zoom: {
                enabled: true,
                mode: 'xy',
                limits: {
                    max: 10,
                    min: 0.5
                }
            }
        }
    });   
}












</script>

</html>
